function css(a,b,c){if("scale"==b||"scaleX"==b||"scaleY"==b||"scaleZ"==b||"rotateX"==b||"rotateY"==b||"rotateZ"==b||"rotate"==b||"skewX"==b||"skewY"==b||"translateX"==b||"translateY"==b||"translateZ"==b)return cssTransform(a,b,c);if(2==arguments.length){var c=getComputedStyle(a)[b];return"opacity"==b&&(c=Math.round(100*c)),parseFloat(c)}"opacity"==b?a.style.opacity=c/100:a.style[b]=c+"px"}function cssTransform(a,b,c){if(a.transform||(a.transform={}),void 0===c){if(void 0===a.transform[b])switch(b){case"scale":case"scaleX":case"scaleY":case"scaleZ":a.transform[b]=100;break;default:a.transform[b]=0}return a.transform[b]}a.transform[b]=c;var d="";for(var e in a.transform)switch(e){case"scale":case"scaleX":case"scaleY":case"scaleZ":d+=" "+e+"("+a.transform[e]/100+")";break;case"rotate":case"rotateX":case"rotateY":case"rotateZ":case"skewX":case"skewY":d+=" "+e+"("+a.transform[e]+"deg)";break;default:d+=" "+e+"("+a.transform[e]+"px)"}a.style.WebkitTransform=a.style.transform=d}function MTween(a){var b=0,c={},d={},e=a.time/20;for(var f in a.target)c[f]=css(a.el,f),d[f]=a.target[f]-c[f];clearInterval(a.el.timer),a.el.timer=setInterval(function(){if(++b>e)clearInterval(a.el.timer),a.callBack&&a.callBack.call(a.el);else{a.callIn&&a.callIn.call(a.el);for(var f in c){var g=Number(Tween[a.type](b,c[f],d[f],e).toFixed(2));css(a.el,f,g)}}},20)}function setBigImg(){window.onload=function(){var a=document.querySelector("#bigImg"),b=0,c=0;css(a,"translateZ",.1),setGesture({el:a,start:function(a){c=css(this,"scale")/100,b=css(this,"rotate")},change:function(a){var d=c*a.scale;d>1.5?d=1.5:d<.5&&(d=.5),css(this,"scale",100*d),css(this,"rotate",b+a.rotation)},end:function(a){var b=css(this,"rotate");b=Math.round(b/90),b*=90,MTween({el:this,target:{rotate:b},time:300,type:"easeBoth"})}});var d,e=document.querySelector("#imgControl"),f=e.querySelectorAll("li"),g={imgMove:function(a,b){var c=css(a,"rotate"),d=css(a,"scale");switch(console.log(c),b){case"leftDeg":c=Math.round(c/90)-1,c*=90;break;case"rightDeg":c=Math.round(c/90)+1,c*=90;break;case"scale+":d*=1.1;break;case"scale-":d*=.9}MTween({el:a,target:{rotate:c,scale:d},time:300,type:"easeBoth"})},setRotate:function(a){a.el.addEventListener("touchstart",function(){a.fn(a.target,a.show),d=setInterval(function(){a.fn.call(a,a.target,a.show)},1e3)},!1)},touchEnd:function(a){for(var b=0;b<a.el.length;b++)a.el[b].addEventListener("touchend",function(){clearInterval(d)},!1)}};g.setRotate({el:f[0],target:a,fn:g.imgMove,show:"leftDeg"}),g.setRotate({el:f[1],target:a,fn:g.imgMove,show:"rightDeg"}),g.setRotate({el:f[2],target:a,fn:g.imgMove,show:"scale+"}),g.setRotate({el:f[3],target:a,fn:g.imgMove,show:"scale-"}),g.touchEnd({el:[f[0],f[1],f[2],f[3]]}),document.querySelector("#returnBtn").addEventListener("touchend",function(){document.querySelector("#dialog").style.transform="scale(0,0)"},!1)}}function mScroll(a){if(a.el){var b=a.el,c=a.el.children[0],d=document.createElement("div"),e=0,f=0,g=0,h=0,i=0,j=0,k=document.documentElement.clientWidth/8,l=b.clientHeight-c.offsetHeight;if(!a.offBar){var m=b.clientHeight/c.offsetHeight;c.style.minHeight="100%",d.style.cssText="width:4px;background:rgba(0,0,0,.5);position:absolute;right:0;top:0;border-radius:2px;opacity:0;transition:.3s opacity;",b.appendChild(d)}css(c,"translateZ",.01),c.addEventListener("touchstart",function(k){l=b.clientHeight-c.offsetHeight,a.offBar||(d.style.display=l>=0?"none":"block",m=b.clientHeight/c.offsetHeight,d.style.height=b.clientHeight*m+"px"),clearInterval(c.timer),e=k.changedTouches[0].pageY,f=css(c,"translateY"),g=f,i=(new Date).getTime(),j=h=0,a.offBar||(d.style.opacity=1),a.start&&a.start()}),c.addEventListener("touchmove",function(b){var n=(new Date).getTime(),o=b.changedTouches[0].pageY,p=o-e,q=f+p;q>k?q=k:q<l-k&&(q=l-k),css(c,"translateY",q),a.offBar||css(d,"translateY",-q*m),h=q-g,g=q,j=n-i,i=n,a.move&&a.move()}),c.addEventListener("touchend",function(b){var e="easeOut",f=Math.round(h/j*10);f=j<=0?0:f;var g=Math.round(30*f+css(c,"translateY"));g>0?(g=0,e="backOut"):g<l&&(g=l,e="backOut"),MTween({el:c,target:{translateY:g},time:Math.round(1.8*Math.abs(g-css(c,"translateY"))),type:e,callBack:function(){a.offBar||(d.style.opacity=0)},callIn:function(){var b=css(c,"translateY");a.offBar||css(d,"translateY",-b*m),a.move&&a.move()}}),a.end&&a.end()})}}function getDis(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)}function getDeg(a,b){var c=b.x-a.x,d=b.y-a.y;return 180*Math.atan2(d,c)/Math.PI}function setGesture(a){var b=a.el,c=!1,d=[];b&&(b.addEventListener("touchstart",function(e){e.touches.length>=2&&(c=!0,d[0]={x:e.touches[0].pageX,y:e.touches[0].pageY},d[1]={x:e.touches[1].pageX,y:e.touches[1].pageY},a.start&&a.start.call(b,e))}),b.addEventListener("touchmove",function(e){if(c&&e.touches.length>=2){var f=[];f[0]={x:e.touches[0].pageX,y:e.touches[0].pageY},f[1]={x:e.touches[1].pageX,y:e.touches[1].pageY};var g=getDis(d[0],d[1]),h=getDis(f[0],f[1]),i=getDeg(d[0],d[1]),j=getDeg(f[0],f[1]);e.scale=h/g,e.rotation=j-i,a.change&&a.change.call(b,e)}}),b.addEventListener("touchend",function(d){c&&(d.touches.length<2||d.targetTouches.length<1)&&(c=!1,a.end&&a.end.call(b,d))}))}var Tween={linear:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeBothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){if(0===a)return b;if(1==(a/=d))return b+c;if(f||(f=.3*d),!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f))+b},elasticOut:function(a,b,c,d,e,f){if(0===a)return b;if(1==(a/=d))return b+c;if(f||(f=.3*d),!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin((a*d-g)*(2*Math.PI)/f)+c+b},elasticBoth:function(a,b,c,d,e,f){if(0===a)return b;if(2==(a/=d/2))return b+c;if(f||(f=d*(.3*1.5)),!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return a<1?-.5*(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f))+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f)*.5+c+b},backIn:function(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},backOut:function(a,b,c,d,e){return void 0===e&&(e=2.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return void 0===e&&(e=1.70158),(a/=d/2)<1?c/2*(a*a*((1+(e*=1.525))*a-e))+b:c/2*((a-=2)*a*((1+(e*=1.525))*a+e)+2)+b},bounceIn:function(a,b,c,d){return c-Tween.bounceOut(d-a,0,c,d)+b},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?c*(7.5625*a*a)+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(a,b,c,d){return a<d/2?.5*Tween.bounceIn(2*a,0,c,d)+b:.5*Tween.bounceOut(2*a-d,0,c,d)+.5*c+b}};document.addEventListener("touchstart",function(a){a.preventDefault()}),function(){function a(){if(n>k.length)return g.innerHTML="NO Image",void setTimeout(function(){g.style.opacity=0,MTween({el:e,target:{translateY:-e.offsetHeight+d.clientHeight},time:300,type:"easeBoth"})},1e3);var a=n+o;a=a<k.length?a:k.length;for(var c=n;c<a;c++){var f=document.createElement("li");f.src=k[c],f.isload=!0,console.log(f),f.addEventListener("touchstart",function(){this.isMove=!1},!1),f.addEventListener("touchmove",function(){this.isMove=!0},!1),f.addEventListener("touchend",function(){this.isMove||(i.style.transition="1s",i.style.transform="scale(1,1)",console.log(j),console.log(this.children[0].src),j.src=this.children[0].src)},!1),d.children[0].children[0].appendChild(f)}b(),g.style.opacity=0}function b(){for(var a=d.getBoundingClientRect(),b=a.bottom,e=0;e<h.length;e++){h[e].getBoundingClientRect().top<b&&h[e].isload&&(h[e].isload=!1,c(h[e]))}}function c(a){var b=new Image;b.src=a.src,b.onload=function(){a.appendChild(b),setTimeout(function(){b.style.opacity=1},30)},b.onerror=function(){}}var d=document.querySelector("#main"),e=d.querySelector("#inner"),f=document.getElementById("contentBox"),g=d.querySelector("#load"),h=f.children,i=document.querySelector("#dialog"),j=document.querySelector("#bigImg");console.log(j),console.log(h);for(var k=[],l=0;l<50;l++)k.push("pics/"+(l%16+1)+".jpg");var m=!1,n=0,o=8;a(),setBigImg(),function(){mScroll({el:d,offBar:!1,start:function(a){console.log("手指按下要执行的函数"),Math.round(css(e,"translateY"))-5<d.clientHeight-e.offsetHeight?(g.style.opacity=1,m=!0):(g.style.opacity=0,m=!1)},move:function(){b(),console.log("滚动时发生的距离")},end:function(b){Math.round(css(e,"translateY"))-5<=d.clientHeight-e.offsetHeight&&m&&(n+=o,a(),clearInterval(e.timer))}})}()}();